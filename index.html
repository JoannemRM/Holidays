<script>
  const festivos = [ /* ... tus festivos aquÃ­ ... */ ];

  const lista = document.getElementById("festivos");

  // Mostrar los festivos
  festivos.forEach(f => {
    const item = document.createElement("li");
    item.className = "bg-white p-4 rounded shadow hover:shadow-lg transition";
    item.innerHTML = `
      <div class="text-xl font-semibold">${f.nombre}</div>
      <div class="text-sm text-gray-600">${f.pais} Â· ${f.fecha} Â· ${f.tipo}</div>
    `;
    lista.appendChild(item);
  });

  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission();
  }

  // Recuperar o inicializar notificaciones mostradas en esta sesiÃ³n
  const notificados = JSON.parse(sessionStorage.getItem("notificadosFestivos") || "{}");

  function guardarNotificado(id) {
    notificados[id] = true;
    sessionStorage.setItem("notificadosFestivos", JSON.stringify(notificados));
  }

  function revisarNotificaciones() {
    const hoy = new Date();
    const hoyStr = hoy.toISOString().split("T")[0];

    festivos.forEach(f => {
      const fechaFestivo = new Date(f.fecha);
      const avisos = [
        { diasAntes: 5, id: `${f.fecha}_5` },
        { diasAntes: 2, id: `${f.fecha}_2` }
      ];

      avisos.forEach(({ diasAntes, id }) => {
        let fechaAviso = new Date(fechaFestivo);
        fechaAviso.setDate(fechaAviso.getDate() - diasAntes);

        // Ajustar si cae en fin de semana
        const diaSemana = fechaAviso.getDay();
        if (diaSemana === 6) fechaAviso.setDate(fechaAviso.getDate() - 1); // sÃ¡bado â†’ viernes
        else if (diaSemana === 0) fechaAviso.setDate(fechaAviso.getDate() - 2); // domingo â†’ viernes

        const fechaAvisoStr = fechaAviso.toISOString().split("T")[0];

        if (hoyStr === fechaAvisoStr && !notificados[id]) {
          new Notification(`ðŸŽ‰ Festivo en ${f.pais}`, {
            body: `${f.nombre} es el ${f.fecha}`,
            requireInteraction: true
          });
          guardarNotificado(id);
        }
      });
    });
  }

  revisarNotificaciones();
  setInterval(revisarNotificaciones, 60 * 1000);
</script>
